(this.webpackJsonpevy=this.webpackJsonpevy||[]).push([[2],{55:function(e,n,t){e.exports=t(65)},65:function(e,n,t){"use strict";t.r(n);var o=t(0),a=t.n(o),c=t(7),r=t.n(c),l=t(21),i=t(13),u=t(45),s=t(96),d=t(97),f=t(30),m=t(10),p=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return function(e,t){return n.reduce((function(e,n){return n(e,t)}),e)}},b=function(e){return new e({host:"peerjs-test-server.herokuapp.com",secure:!0})},v=new(t(46).EventEmitter),h=function(e,n,a){var c=p(j,null!==a&&void 0!==a?a:g),r=Object(o.useReducer)(c,null!==n&&void 0!==n?n:null),l=Object(i.a)(r,2),u=l[0],s=l[1],d=Object(o.useState)({peer:{id:null,ready:!1},host:{id:null,ready:!1},connections:[],isHost:!1,error:null}),h=Object(i.a)(d,2),O=h[0],E=h[1],y=Object(o.useState)(null),w=Object(i.a)(y,2),k=w[0],S=w[1],C=Object(o.useState)(null),R=Object(i.a)(C,2),A=R[0],H=R[1],M=O.connections,B=Object(o.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.log("dispatching",e),null!==A&&A.send(e),M.forEach((function(t){return(null===n||void 0===n?void 0:n.label)!==t.label?t.send(e):void 0})),s(e)}),[A,M,s]),J=Object(o.useCallback)((function(e,n){e.send(n),console.log("sending to connection",n)}),[]);return Object(o.useEffect)((function(){console.log("update initialstate dispatcher"),v.removeAllListeners();var e={type:"initialState",payload:u};v.on("send-open-action",(function(n){return J(n,e)}))}),[u]),Object(o.useEffect)((function(){return Promise.all([t.e(0),t.e(1)]).then(t.t.bind(null,100,7)).then((function(n){var t=n.default;console.log("creating a new peer");var o=b(t);S(o);var a=function(e){console.log("creating a host"),E((function(n){return Object(m.a)({},n,{isHost:!0,host:Object(m.a)({},n.host,{id:e,ready:!0})})})),o.on("connection",(function(e){console.log("new connection to host",e),E((function(n){return Object(m.a)({},n,{connections:[].concat(Object(f.a)(n.connections),[e])})})),e.on("open",(function(){return v.emit("send-open-action",e)})),e.on("data",(function(n){console.log("received data on host",n),B(n,e)})),e.on("close",(function(){return E((function(n){return Object(m.a)({},n,{connections:n.connections.filter((function(n){return n.label!==e.label}))})}))}))}))};o.on("error",(function(e){if(console.log("error happened",e),"unavailable-id"===e.type)return a(O.peer.id);E((function(n){return Object(m.a)({},n,{error:new Error(e.type)})}))})),o.on("open",(function(n){console.log("peer with id is open",n),E((function(e){return Object(m.a)({},e,{peer:Object(m.a)({},e.peer,{id:n,ready:!0})})})),null===e?a(n):function(e){console.log("connection to a host");var n=o.connect(e);H(n),n.on("open",(function(){console.log("connection to host open"),E((function(n){return Object(m.a)({},n,{host:{id:e,ready:!0}})}))})),n.on("data",(function(e){console.log("received data on client",e),s(e)}))}(e)}))})),function(){k&&k.destroy()}}),[]),[u,B,O]},g=function(e,n){return e},j=function(e,n){return function(e){return"initialState"===e.type}(n)?n.payload:e},O=t(39),E={addMessage:Object(O.createAction)("message/add")()},y=Object(O.createReducer)({messages:[]},{"message/add":function(e,n){return Object(m.a)({},e,{messages:[].concat(Object(f.a)(e.messages),[n.payload])})}}),w=function(e){var n;Object(u.a)(e);var t=Object(l.h)("/t/:id"),c=Object(l.g)(),r=a.a.useState(""),f=Object(i.a)(r,2),m=f[0],p=f[1],b=h(null!==(n=null===t||void 0===t?void 0:t.params.id)&&void 0!==n?n:null,{messages:[]},y),v=Object(i.a)(b,3),g=v[0],j=v[1],O=v[2],w=a.a.useCallback((function(e){j(E.addMessage(e)),p("")}),[j]);return Object(o.useEffect)((function(){void 0===(null===t||void 0===t?void 0:t.params.id)&&null!==O.host.id&&c.push("/t/".concat(O.host.id))}),[t,O.host.id]),null!==O.error?a.a.createElement("code",null,O.error.message):O.host.ready?null===g?a.a.createElement("p",null,"No state"):a.a.createElement(a.a.Fragment,null,a.a.createElement("div",null,"Current peer id: ",a.a.createElement("code",null,O.peer.id)," Ready ",O.peer.ready),a.a.createElement("div",null,"Host id: ",a.a.createElement("code",null,O.host.id)," Ready ",O.host.ready),a.a.createElement("div",null,"Connected to me: ",a.a.createElement("code",null,O.connections.map((function(e){return e.label})).join(", "))),g.messages.map((function(e,n){return a.a.createElement("p",{key:n},e)})),a.a.createElement(s.a,{value:m,onChange:function(e){return p(e.currentTarget.value)}}),a.a.createElement(d.a,{onClick:function(){return w(m)}},"Send")):a.a.createElement("p",null,"Loading...")};var k=function(){return a.a.createElement(l.d,null,a.a.createElement(l.b,{path:"/t/:id"},a.a.createElement(w,null)),a.a.createElement(l.b,{path:"/"},a.a.createElement(l.a,{to:"/t/"})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var S=t(31),C=function(e){var n=e.children;return a.a.createElement(S.a,{basename:"/evy"},n)};r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(C,null,a.a.createElement(k,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[55,3,4]]]);
//# sourceMappingURL=main.9138ea26.chunk.js.map