(this.webpackJsonpevy=this.webpackJsonpevy||[]).push([[0],{64:function(e,t,n){e.exports=n(78)},78:function(e,t,n){"use strict";n.r(t);var r,a,c=n(0),o=n.n(c),u=n(9),l=n.n(u),i=n(23),s=n(6),f=n(41),d=n(113),m=n(114),p=n(18),b=n(8),v=n(13),O=n(53),j=Object(c.createContext)(null),E=function(){return Object(c.useContext)(j)},g=function(e){return{id:e.peer,send:function(t){return e.send(t)}}},y=function(e,t,n){var r={id:t.id,send:function(t){e.emit("host/data",a,t),e.emit("any/data",a,t)}},a={id:t.id,send:function(t){e.emit("peer/data",r,t),e.emit("any/data",r,t)}};e.emit("host/data",a,n),e.emit("any/data",a,n)},h=function(e){var t=Object(c.useState)(new O.EventEmitter),r=Object(s.a)(t,1)[0],a=Object(c.useState)({peer:{id:null,ready:!1},host:{id:null,ready:!1},connections:[],isHost:!1,error:null}),o=Object(s.a)(a,2),u=o[0],l=o[1],i=Object(c.useState)(null),f=Object(s.a)(i,2),d=f[0],m=f[1],v=Object(c.useState)(null),j=Object(s.a)(v,2),E=j[0],h=j[1],k=u.connections,C=Object(c.useCallback)((function(e){console.log("dispatch to host",E,e.type,"by peer",u),null!==E&&E.send(e),u.isHost&&y(r,d,e)}),[E,d,u.isHost]),x=Object(c.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.log("dispatch to connections",k,e.type,"by peer",u),k.forEach((function(n){return(null===t||void 0===t?void 0:t.id)!==n.id?n.send(e):void 0})),u.isHost&&(null===t||void 0===t?void 0:t.id)!==d.id&&y(r,d,e)}),[k,d,u.isHost]);return Object(c.useEffect)((function(){return Promise.all([n.e(3),n.e(4)]).then(n.t.bind(null,117,7)).then((function(t){var n=t.default,a=new n({host:"peerjs-test-server.herokuapp.com",secure:!0});m(a),console.log("peer created",a);var c=function(e){console.log("creating a host"),r.emit("open"),l((function(t){return Object(b.a)({},t,{isHost:!0,host:Object(b.a)({},t.host,{id:e,ready:!0})})})),a.on("connection",(function(e){console.log("peer connected to host"),l((function(t){return Object(b.a)({},t,{connections:[].concat(Object(p.a)(t.connections),[g(e)])})})),e.on("open",(function(){return r.emit("peer/open",g(e))})),e.on("data",(function(t){console.log("receive data from peer"),r.emit("peer/data",g(e),t),r.emit("any/data",g(e),t)})),e.on("close",(function(){return l((function(t){return Object(b.a)({},t,{connections:t.connections.filter((function(t){return t.id!==g(e).id}))})}))}))}))};a.on("error",(function(e){if(console.log("error happened",e),"unavailable-id"===e.type)return c(u.peer.id);l((function(t){return Object(b.a)({},t,{error:new Error(e.type)})}))})),a.on("open",(function(t){l((function(e){return Object(b.a)({},e,{peer:Object(b.a)({},e.peer,{id:t,ready:!0})})})),null===e?c(t):function(e){console.log("connecting to host");var t=a.connect(e,{serialization:"json"});h(t),t.on("open",(function(){console.log("host is open"),l((function(t){return Object(b.a)({},t,{host:{id:e,ready:!0}})})),r.emit("host/open",g(t))})),t.on("data",(function(e){console.log("receive data from host"),r.emit("host/data",g(t),e),r.emit("any/data",g(t),e)}))}(e)}))})),function(){d&&d.destroy()}}),[]),[u,r,C,x]},k=function(e,t,n,r){!function(e,t,n,r){var a=Object(c.useRef)(n);Object(c.useEffect)((function(){a.current=n}),r),Object(c.useEffect)((function(){console.log(e,n,r);var c=function(){return a.current.apply(a,arguments)};return t.on(e,c),function(){t.removeListener(e,c)}}),[e])}("any/data",e,(function(e,r){Object(v.isActionOf)(t,r)&&(console.log("on:",r.type),n(e,r))}),[t].concat(Object(p.a)(r)))},C=n(29),x=n.n(C),w={login:Object(v.createAction)("login")(),loginResponse:Object(v.createAction)("login/response")(),newUser:Object(v.createAction)("login/new")()},S=x()({currentUser:null,users:[]},(function(e){var t=e.setState;return{addUser:function(e){return t((function(t){return Object(b.a)({},t,{users:[].concat(Object(p.a)(t.users),[e])})}))},initState:function(e){return t(e)}}})),U=Object(s.a)(S,2),M=U[0],R=U[1],I=function(){var e=Object(c.useContext)(M),t=E(),n=Object(s.a)(t,4),r=(n[0],n[1]),a=n[2],o=n[3],u=Object(c.useCallback)((function(e){a(w.login(e))}),[a]);return Object(c.useEffect)((function(){}),[]),k(r,w.login,(function(t,n){console.log("on login");var r={userId:t.id,username:n.payload},a=Object(b.a)({},e,{users:[].concat(Object(p.a)(e.users),[r])});t.send(w.loginResponse(Object(b.a)({},a,{currentUser:r}))),o(w.newUser(r),t)}),[e,o]),k(r,w.newUser,(function(t,n){console.log("on new user"),e.addUser(n.payload)}),[e.addUser]),k(r,w.loginResponse,(function(t,n){console.log("on login resp"),e.initState(n.payload)}),[e.initState]),[e,u]},A={sendMessage:Object(v.createAction)("message/send")(),receiveMessage:Object(v.createAction)("message/receive")()},G=x()({messages:[]},(function(e){var t=e.setState;return{addMessage:function(e){return t((function(t){return Object(b.a)({},t,{messages:[].concat(Object(p.a)(t.messages),[e])})}))}}})),N=Object(s.a)(G,2),F=N[0],q=N[1],H=function(){var e=Object(c.useContext)(F),t=E(),n=Object(s.a)(t,4),r=(n[0],n[1]),a=n[2],o=n[3],u=Object(c.useContext)(M),l=Object(c.useCallback)((function(e){a(A.sendMessage(e))}),[a]);return k(r,A.sendMessage,(function(e,t){var n={author:u.users.find((function(t){return t.userId===e.id})),text:t.payload};o(A.receiveMessage(n))}),[u.users,o]),k(r,A.receiveMessage,(function(t,n){e.addMessage(n.payload)}),[]),[e,l]},P=x()({connecting:!0},(function(e){var t=e.setState;return{setConnected:function(){return t({connecting:!1})}}})),T=Object(s.a)(P,2),W=T[0],X=T[1],z=function(){var e=E(),t=Object(s.a)(e,4),n=(t[0],t[1]),r=(t[2],t[3],Object(c.useContext)(W));return Object(c.useEffect)((function(){n.on("host/open",(function(){return r.setConnected()})),n.on("open",(function(){return r.setConnected()}))}),[]),[r.connecting]},B=function(e){Object(f.a)(e);var t=o.a.useState(""),n=Object(s.a)(t,2),r=n[0],a=n[1],u=H(),l=Object(s.a)(u,2),i=l[0],p=l[1],b=I(),v=Object(s.a)(b,2),O=v[0],j=v[1],E=z(),g=Object(s.a)(E,1)[0],y=Object(c.useCallback)((function(e){j(e),a("")}),[j]),h=Object(c.useCallback)((function(e){p(e),a("")}),[p]);return g?o.a.createElement(o.a.Fragment,null,"Connecting..."):null===O.currentUser?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,"Choose username:"),o.a.createElement(d.a,{value:r,onChange:function(e){return a(e.currentTarget.value)}}),o.a.createElement(m.a,{onClick:function(){return y(r)}},"Send")):o.a.createElement(o.a.Fragment,null,"Current user: ",O.currentUser.username,o.a.createElement("br",null),"Users in the room: ",O.users.map((function(e,t){return o.a.createElement("p",{key:t},e.username," : ",e.userId)})),o.a.createElement("hr",null),i.messages.map((function(e,t){return o.a.createElement("p",{key:t},"[",e.author.username,"]",e.text)})),o.a.createElement(d.a,{value:r,onChange:function(e){return a(e.currentTarget.value)}}),o.a.createElement(m.a,{onClick:function(){return h(r)}},"Send"))},J=function(e){var t,n=e.route,r=void 0===n?"peer":n,a=e.children,u=Object(i.g)("/".concat(r,"/:id")),l=Object(i.f)(),f=h(null!==(t=null===u||void 0===u?void 0:u.params.id)&&void 0!==t?t:null),d=Object(s.a)(f,3),m=d[0];d[1],d[2];return Object(c.useEffect)((function(){void 0===(null===u||void 0===u?void 0:u.params.id)&&null!==m.host.id&&l.push("/".concat(r,"/").concat(m.host.id))}),[u,m.host.id,l]),o.a.createElement(j.Provider,{value:f},a)},D=n(58),L=function e(t){var n=t.providers,r=t.children,a=Object(D.a)(n),o=a[0],u=a.slice(1);return void 0!==o?c.createElement(o,null,c.createElement(e,{providers:u},r)):c.createElement(c.Fragment,null,r)},Y=n(112),$=n(24),K=n.n($),Q=n(36),V=function(e){var t=Object(c.useState)(e),n=Object(s.a)(t,2),r=n[0];return[r,function(e,t){var n=Object(c.useRef)([]);return Object(c.useEffect)((function(){n.current.forEach((function(t){return t(e)})),n.current=[]}),[e]),Object(c.useCallback)((function(e){return new Promise((function(r,a){t((function(t){try{var c=e instanceof Function?e(t):e;return c===t?r(c):n.current.push(r),c}catch(o){throw a(o),o}}))}))}),[t])}(r,n[1])]},Z=[[[0,0],[0,1],[0,2]],[[1,0],[1,1],[1,2]],[[2,0],[2,1],[2,2]],[[0,0],[1,0],[2,0]],[[0,1],[1,1],[2,1]],[[0,2],[1,2],[2,2]],[[0,0],[1,1],[2,2]],[[0,2],[1,1],[2,0]]],_=function(e){return Z.reduce((function(t,n){var r=Object(s.a)(n,3),c=Object(s.a)(r[0],2),o=c[0],u=c[1],l=Object(s.a)(r[1],2),i=l[0],f=l[1],d=Object(s.a)(r[2],2),m=d[0],p=d[1];return null!==t?t:e[o][u]!==a.Empty&&e[o][u]===e[i][f]&&e[o][u]===e[m][p]?e[o][u]:null}),null)},ee=function(e,t,n){return e.map((function(e,r){return r===t?n:e}))};!function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Ended=2]="Ended"}(r||(r={})),function(e){e[e.Empty=0]="Empty",e[e.X=1]="X",e[e.O=2]="O"}(a||(a={}));var te=[[a.Empty,a.Empty,a.Empty],[a.Empty,a.Empty,a.Empty],[a.Empty,a.Empty,a.Empty]],ne=function(){var e=V({state:r.NotStarted,field:[].concat(te).concat(),players:[null,null],currentMove:null,winner:null}),t=Object(s.a)(e,2),n=t[0],o=t[1],u=Object(c.useCallback)((function(e){return null!==e.players[0]&&null!==e.players[1]}),[]),l=Object(c.useCallback)((function(e){return n.state!==r.NotStarted?null:null===n.players[0]?o((function(t){return Object(b.a)({},t,{players:[e,t.players[1]]})})):null!==n.players[0]&&null===n.players[1]?o((function(t){return Object(b.a)({},t,{players:[t.players[0],e]})})):null}),[o,n.state,n.players]),i=Object(c.useCallback)((function(){return o((function(e){return e.state===r.NotStarted&&u(e)?Object(b.a)({},e,{state:r.Running,currentMove:e.players[0],field:[].concat(te).concat()}):e}))}),[o]),f=Object(c.useCallback)(function(){var e=Object(Q.a)(K.a.mark((function e(t,c){var u,l,i,s,f,d,m;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.state===r.Running){e.next=2;break}return e.abrupt("return");case 2:if(null!==n.currentMove){e.next=4;break}return e.abrupt("return");case 4:if(-1!==(u=n.players.findIndex((function(e){return(null===e||void 0===e?void 0:e.userId)===t.userId})))){e.next=7;break}return e.abrupt("return");case 7:if(l=n.players[u],n.currentMove.userId===l.userId){e.next=10;break}return e.abrupt("return");case 10:if(n.field[c.x][c.y]===a.Empty){e.next=13;break}return e.abrupt("return");case 13:if(i=0===u?a.X:a.O,s=ee(n.field,c.x,ee(n.field[c.x],c.y,i)),f=_(s),d=!s.some((function(e){return e.some((function(e){return e===a.Empty}))})),null===f&&!d){e.next=19;break}return e.abrupt("return",o((function(e){return Object(b.a)({},e,{state:r.Ended,field:Object(p.a)(s).concat(),winner:d?null:l,currentMove:null})})));case 19:return m=0===u?1:0,e.abrupt("return",o((function(e){return Object(b.a)({},e,{field:Object(p.a)(s).concat(),currentMove:e.players[m]})})));case 21:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[n.players,n.state,n.currentMove,n.field]),d=Object(c.useCallback)((function(){if(n.state===r.Ended)return o((function(e){return Object(b.a)({},e,{state:r.NotStarted,field:[].concat(te).concat(),currentMove:null,players:[null,null],winner:null})}))}),[n.state]);return{gameState:n,signUpPlayer:l,startGame:i,makeMove:f,restartGame:d}},re={signUpRequest:Object(v.createAction)("tictac/signup/request")(),signUpResponse:Object(v.createAction)("tictac/signup/response")(),successSignUpResponse:Object(v.createAction)("tictac/signup-success/response")(),startGame:Object(v.createAction)("tictac/game/start")(),restartGame:Object(v.createAction)("tictac/game/restart")(),moveRequest:Object(v.createAction)("tictac/move/request")(),moveResponse:Object(v.createAction)("tictac/move/response")()},ae=n(111),ce=Object(ae.a)({field:{},row:{display:"flex",flexDirection:"row"},cell:{border:"1px solid black",height:"3em",width:"3em",boxSizing:"border-box","&:hover":{border:"2px solid black"}}}),oe=function(e){var t=e.field,n=e.onClick,r=void 0===n?function(){}:n,c=ce();return o.a.createElement("div",{className:c.cell,onClick:r},t!==a.Empty?a[t]:null)},ue=function(e){var t=e.field,n=e.onMove,r=ce(),a=Object(c.useCallback)((function(e){return function(){return n(e)}}),[n]);return o.a.createElement("div",{className:r.field},o.a.createElement("div",{className:r.row},o.a.createElement(oe,{field:t[0][0],onClick:a({x:0,y:0})}),o.a.createElement(oe,{field:t[0][1],onClick:a({x:0,y:1})}),o.a.createElement(oe,{field:t[0][2],onClick:a({x:0,y:2})})),o.a.createElement("div",{className:r.row},o.a.createElement(oe,{field:t[1][0],onClick:a({x:1,y:0})}),o.a.createElement(oe,{field:t[1][1],onClick:a({x:1,y:1})}),o.a.createElement(oe,{field:t[1][2],onClick:a({x:1,y:2})})),o.a.createElement("div",{className:r.row},o.a.createElement(oe,{field:t[2][0],onClick:a({x:2,y:0})}),o.a.createElement(oe,{field:t[2][1],onClick:a({x:2,y:1})}),o.a.createElement(oe,{field:t[2][2],onClick:a({x:2,y:2})})))},le=function(e){var t=e.field,n=e.onMove,r=e.currentMove,a=I(),c=Object(s.a)(a,1)[0].currentUser;return o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"Game running!"),c.userId==r.userId?o.a.createElement("p",null,"Your move: "):o.a.createElement("p",null,"Opponents move..."),o.a.createElement(ue,{field:t,onMove:n}))},ie=function(e){Object(f.a)(e);var t=o.a.useState(""),n=Object(s.a)(t,2),a=n[0],u=n[1],l=H(),i=Object(s.a)(l,2),p=i[0],b=i[1],v=I(),O=Object(s.a)(v,2),j=O[0],g=O[1],y=function(){var e=E(),t=Object(s.a)(e,4),n=t[0],r=t[1],a=t[2],o=t[3],u=Object(c.useContext)(M),l=ne(),i=l.gameState,f=l.signUpPlayer,d=l.startGame,m=l.makeMove,p=l.restartGame,b=Object(c.useCallback)((function(){return a(re.signUpRequest())}),[a]);k(r,re.signUpRequest,(function(e,t){var n=u.users.find((function(t){return t.userId===e.id}));o(re.signUpResponse(n))}),[u.users,o]),k(r,re.signUpResponse,function(){var e=Object(Q.a)(K.a.mark((function e(t,n){return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(n.payload);case 2:e.sent&&o(re.successSignUpResponse());case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[f,o]),k(r,re.successSignUpResponse,(function(e,t){o(re.startGame())}),[i.state,o]),k(r,re.startGame,(function(e,t){d()}),[d]);var v=Object(c.useCallback)((function(e){return a(re.moveRequest(e))}),[a]);k(r,re.moveRequest,function(){var e=Object(Q.a)(K.a.mark((function e(t,n){var r;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u.users.find((function(e){return e.userId===t.id})),o(re.moveResponse({cords:n.payload,user:r}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[i.players,i.state,o]),k(r,re.moveResponse,(function(e,t){m(t.payload.user,t.payload.cords)}),[m]);var O=Object(c.useCallback)((function(){a(re.restartGame())}),[a,n.peer]);return k(r,re.restartGame,(function(e,t){p(),o(re.restartGame(),e)}),[p,o]),{gameState:i,signUp:b,move:v,restart:O}}(),h=y.gameState,C=y.signUp,x=y.move,w=y.restart,S=z(),U=Object(s.a)(S,1)[0],R=Object(c.useCallback)((function(e){g(e),u("")}),[g]),A=Object(c.useCallback)((function(e){b(e),u("")}),[b]);return U?o.a.createElement(o.a.Fragment,null,"Connecting..."):null===j.currentUser?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,"Choose username:"),o.a.createElement(d.a,{value:a,onChange:function(e){return u(e.currentTarget.value)}}),o.a.createElement(m.a,{onClick:function(){return R(a)}},"Send")):o.a.createElement(Y.a,{container:!0},o.a.createElement(Y.a,{item:!0,xs:3},"Current user: ",j.currentUser.username,o.a.createElement("br",null),"Users in the room: ",j.users.map((function(e,t){return o.a.createElement("p",{key:t},e.username," : ",e.userId)})),o.a.createElement("hr",null),p.messages.map((function(e,t){return o.a.createElement("p",{key:t},"[",e.author.username,"]",e.text)})),o.a.createElement(d.a,{value:a,onChange:function(e){return u(e.currentTarget.value)}}),o.a.createElement(m.a,{onClick:function(){return A(a)}},"Send")),o.a.createElement(Y.a,{item:!0,xs:9},o.a.createElement("p",null,"State: ",r[h.state]),o.a.createElement("p",null,"Players: ",h.players.filter((function(e){return null!==e})).map((function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.username)&&void 0!==t?t:""})).join(",")),h.state==r.NotStarted?o.a.createElement(m.a,{onClick:C},"Signup for the game"):null,h.state==r.Running?o.a.createElement(le,{field:h.field,onMove:x,currentMove:h.currentMove}):null,h.state==r.Ended?o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"Game ended"),null!==h.winner?o.a.createElement("p",null,"Winner: ",h.winner.username,"!"):o.a.createElement("p",null,"Tie!"),o.a.createElement(m.a,{onClick:w},"Restart game"),o.a.createElement(ue,{field:h.field,onMove:function(){}})):null))};var se=function(){return o.a.createElement(i.c,null,o.a.createElement(i.a,{path:"/tictac"},o.a.createElement(J,{route:"tictac"},o.a.createElement(L,{providers:[q,R,X]},o.a.createElement(ie,null)))),o.a.createElement(i.a,{path:"/t"},o.a.createElement(J,null,o.a.createElement(L,{providers:[q,R,X]},o.a.createElement(B,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var fe=n(38),de=function(e){var t=e.children;return o.a.createElement(fe.a,null,t)};l.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(de,null,o.a.createElement(se,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[64,1,2]]]);
//# sourceMappingURL=main.5f77ba93.chunk.js.map